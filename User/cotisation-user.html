<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tableau Vide avec Pagination Interactive</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body class="bg-light">

  <div class="container py-5 text-center">
    <button id="jeCotiseBtn" class="btn btn-dark btn-lg">
      Je cotise
    </button>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="cotisationModal" tabindex="-1" aria-labelledby="cotisationModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered p-5">
      <div class="modal-content">
        <div class="modal-body text-center border-end p-5">
          <img id="photo" src="/Images/tontine.jpg" alt="Photo de profil"
            class="rounded-circle" style="width: 30%;">
          <h5 id="userName">Faly Seck</h5>
          <p>Ajouter une cotisation</p>
          <form id="cotisationForm">
            <input type="date" class="form-control" id="cotisationDate" required>
            <input type="number" class="form-control mt-3" id="cotisationMontant" placeholder="Montant" required>
            <button type="submit" class="btn btn-dark mt-3">Enregistrer</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Tableau -->
  <div class="d-flex justify-content-center align-items-center">
    <div class="container my-5">
      <div class="table-container">
        <div class="row justify-content-center">
          <div class="col-md-7">
            <table class="table table-hover align-middle">
              <thead class="table-header">
                <tr>
                  <th style="background-color: #20DF7F;">Mois</th>
                  <th style="background-color: #20DF7F;">Date début</th>
                  <th style="background-color: #20DF7F;">Seuil</th>
                  <th style="background-color: #20DF7F;">Statut</th>
                  <th style="background-color: #20DF7F;">Actions</th>
                </tr>
              </thead>
              <tbody id="tableauCotisations">
                <!-- Lignes dynamiques -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <nav class="mt-3">
        <ul class="pagination justify-content-center" id="pagination">
          <li class="page-item"><a class="page-link" href="#" data-page="prev">Previous</a></li>
          <li class="page-item active"><a class="page-link" href="#" data-page="1">1</a></li>
          <li class="page-item"><a class="page-link" href="#" data-page="2">2</a></li>
          <li class="page-item"><a class="page-link" href="#" data-page="3">3</a></li>
          <li class="page-item"><a class="page-link" href="#" data-page="4">4</a></li>
          <li class="page-item"><a class="page-link" href="#" data-page="next">Next</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ⚡ Script Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD1gEj4mV2hRaJImHW1IsyQjZ1uEusY-bM",
      authDomain: "tontine-bakeli.firebaseapp.com",
      projectId: "tontine-bakeli",
      storageBucket: "tontine-bakeli.appspot.com",
      messagingSenderId: "542050089083",
      appId: "1:542050089083:web:41426bb7f5c41c496acade"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const cotisationForm = document.getElementById("cotisationForm");
    const tableauCotisations = document.getElementById("tableauCotisations");

    let montantTotal = 0;

    async function chargerCotisations() {
      tableauCotisations.innerHTML = "";
      montantTotal = 0;

      const snapshot = await getDocs(collection(db, "Cotisations"));
      snapshot.forEach((doc) => {
        const data = doc.data();
        montantTotal += data.montant;

        let row = `
          <tr>
            <td>${new Date(data.date).toLocaleDateString("fr-FR", { month: "long" })}</td>
            <td>${data.date}</td>
            <td>${data.montant} FCFA</td>
            <td><span class="badge bg-success">Payé</span></td>
            <td>
              <i class="fa-regular fa-eye me-2"></i>
              <i class="fa-solid fa-pen-to-square"></i>
            </td>
          </tr>`;
        tableauCotisations.innerHTML += row;
      });

      // Si aucune donnée trouvée, remplir avec des lignes vides
      if (snapshot.empty) {
        for (let i = 0; i < 5; i++) {
          tableauCotisations.innerHTML += `
            <tr>
              <td class="text-muted text-center">-</td>
              <td class="text-muted text-center">-</td>
              <td class="text-muted text-center">-</td>
              <td class="text-muted text-center">-</td>
              <td>
                <i class="fa-regular fa-eye me-2"></i>
                <i class="fa-solid fa-pen-to-square"></i>
              </td>
            </tr>`;
        }
      }
    }

    cotisationForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const date = document.getElementById("cotisationDate").value;
      const montant = parseInt(document.getElementById("cotisationMontant").value);

      await addDoc(collection(db, "Cotisations"), { date, montant });

      chargerCotisations();
      cotisationForm.reset();
    });

    chargerCotisations();
  </script>

  <!-- ⚡ Script Pagination -->
  <script>
    const jeCotiseBtn = document.getElementById('jeCotiseBtn');
    const cotisationModal = new bootstrap.Modal(document.getElementById('cotisationModal'));
    const pagination = document.getElementById("pagination");
   //

    let currentPage = 1;
    const totalPages = 4;
    const rowsPerPage = 5;

    jeCotiseBtn.addEventListener('click', () => {
      cotisationModal.show();
    });

    function renderTable(page) {
      tableauCotisations.innerHTML = "";
      for (let i = 0; i < rowsPerPage; i++) {
        tableauCotisations.innerHTML += `
          <tr>
            <td class="text-center text-muted">-</td>
            <td class="text-center text-muted">-</td>
            <td class="text-center text-muted">-</td>
            <td class="text-center text-muted">-</td>
            <td>
              <i class="fa-regular fa-eye me-2"></i>
              <i class="fa-solid fa-pen-to-square"></i>
            </td>
          </tr>`;
      }
    }

    function updatePagination(page) {
      if (page === "prev" && currentPage > 1) currentPage--;
      else if (page === "next" && currentPage < totalPages) currentPage++;
      else if (!isNaN(page)) currentPage = parseInt(page);

      pagination.querySelectorAll(".page-item").forEach(item => item.classList.remove("active"));
      pagination.querySelectorAll(".page-item").forEach(item => {
        const link = item.querySelector("a");
        if (link && link.dataset.page == currentPage) item.classList.add("active");
      });

      renderTable(currentPage);
    }

    pagination.addEventListener("click", function (e) {
      e.preventDefault();
      if (e.target.tagName === "A") updatePagination(e.target.dataset.page);
    });

    renderTable(currentPage);
  </script>
</body>
</html>
